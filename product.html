<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết sản phẩm - BookSelf</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <!-- Dynamic Header -->
    <div id="header-placeholder"></div>

    <main class="product-detail-page">
        <div class="container">
            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <a href="index.html">Trang chủ</a>
                <span>/</span>
                <a href="category.html">Sản phẩm</a>
                <span>/</span>
                <span id="breadcrumb-product">Loading...</span>
            </nav>

            <div class="product-detail-container">
                <!-- Product Images -->
                <div class="product-images">
                    <div class="main-image">
                        <img id="mainProductImage" src="" alt="Product Image">
                        <span class="discount-badge" id="discountBadge" style="display: none;"></span>
                        <span class="new-badge" id="newBadge" style="display: none;"></span>
                    </div>
                    <div class="image-thumbnails" id="imageThumbnails">
                        <!-- Dynamic thumbnails will be loaded here -->
                    </div>
                </div>

                <!-- Product Info -->
                <div class="product-info">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                        <h1 class="product-title" id="productTitle" style="margin: 0; flex: 1;">Loading...</h1>
                        <button class="wishlist-btn" id="wishlistBtn" style="position: static; margin-left: 15px;" title="Thêm vào yêu thích">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <p class="product-author" id="productAuthor">Loading...</p>
                    <div class="product-rating" id="productRating">
                        <div class="stars"></div>
                        <span class="rating-text"></span>
                    </div>
                    <div class="product-meta">
                        <span class="brand">Thương hiệu: <strong id="productBrand"><a href="#" id="publisherLink">BookSelf</a></strong></span>
                        <span class="sku">Mã sản phẩm: <strong class="product-sku" id="productSku"></strong></span>
                    </div>

                    <div class="product-price">
                        <span class="current-price" id="currentPrice">Loading...</span>
                        <span class="original-price" id="originalPrice" style="display: none;"></span>
                    </div>
                    
                    <div class="stock-status" id="stockStatus">
                        <i class="fas fa-check-circle"></i>
                        <span>Còn hàng</span>
                    </div>
                    
                    <div class="discount-badge" id="productDiscountBadge" style="display: none;"></div>

                    <div class="product-actions">
                        <div class="quantity-selector">
                            <button class="qty-btn minus" onclick="changeQuantity(-1)">-</button>
                            <input type="number" value="1" min="1" id="quantity">
                            <button class="qty-btn plus" onclick="changeQuantity(1)">+</button>
                        </div>
                        <div class="action-buttons">
                            <button class="btn-add-cart" id="addToCartBtn">Cho vào giỏ</button>
                            <button class="btn-buy-now" id="buyNowBtn">Mua ngay</button>
                        </div>
                    </div>

                    <div class="product-features">
                        <div class="feature-item">
                            <i class="fa-solid fa-truck"></i>
                            <div>
                                <strong>Hoàn tiền 111%</strong>
                                <span>nếu hàng giả</span>
                            </div>
                        </div>
                        <div class="feature-item">
                            <i class="fa-solid fa-shield-alt"></i>
                            <div>
                                <strong>Mở hộp kiểm tra</strong>
                                <span>nhận hàng</span>
                            </div>
                        </div>
                        <div class="feature-item">
                            <i class="fa-solid fa-clock"></i>
                            <div>
                                <strong>Đổi trả trong 30 ngày</strong>
                                <span>nếu có lỗi</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Seller Info + Related Products -->
                <div class="right-column">
                    <!-- Seller Info -->
                    <div class="seller-info">
                        <div class="seller-badge">
                            <img src="images/logo.png" alt="BookSelf" class="seller-logo">
                            <div class="seller-details">
                                <h4 id="shopName"><a href="#" id="shopLink">BOOKSELF</a></h4>
                                <span>Chính hãng</span>
                            </div>
                        </div>
                        <div class="seller-actions">
                            <button class="btn-chat" onclick="openChat()">Chat</button>
                            <button class="btn-view-shop" onclick="viewShop()">Xem shop</button>
                        </div>
                    </div>

                    <!-- Related Products -->
                    <div class="related-products-section">
                        <h3>Sản phẩm liên quan</h3>
                        <div class="related-products-grid" id="relatedProductsGrid">
                            <!-- Dynamic related products will be loaded here -->
                        </div>
                    </div>
                </div>
                <!-- Product Details Tabs -->
                <div class="product-details-tabs">
                    <div class="tab-headers">
                        <button class="tab-btn active" onclick="showTab('description')">Mô tả</button>
                        <button class="tab-btn" onclick="showTab('specifications')">Thông số</button>
                        <button class="tab-btn" onclick="showTab('reviews')">Đánh giá</button>
                    </div>
                    
                    <div class="tab-content">
                        <div id="description" class="tab-pane active">
                            <div id="productDescription">Loading...</div>
                        </div>
                        
                        <div id="specifications" class="tab-pane">
                            <div id="productSpecifications">Loading...</div>
                        </div>
                        
                        <div id="reviews" class="tab-pane">
                            <div id="productReviews">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Dynamic Footer -->
    <div id="footer-placeholder"></div>

    <!-- Dynamic Chatbot -->
    <div id="chatbot-placeholder"></div>

    <script src="load-components.js"></script>
    <script src="data.js"></script>
    <script src="script.js"></script>
    <script src="auth.js"></script>
    
    <script>
        // Product detail specific functions
        function changeMainImage(thumbnail) {
            const mainImage = document.getElementById('mainProductImage');
            mainImage.src = thumbnail.src;
            
            // Update active thumbnail
            document.querySelectorAll('.thumbnail').forEach(thumb => thumb.classList.remove('active'));
            thumbnail.classList.add('active');
        }

        function changeQuantity(delta) {
            const quantityInput = document.getElementById('quantity');
            let currentValue = parseInt(quantityInput.value);
            let newValue = currentValue + delta;
            
            if (newValue >= 1) {
                quantityInput.value = newValue;
            }
        }

        function showTab(tabName) {
            // Hide all tab panes
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function openChat() {
            // Use the global function from script.js
            if (window.openChat && typeof window.openChat === 'function') {
                window.openChat();
            } else {
                // Fallback if script.js not loaded yet
                showNotification('Đang khởi tạo chat...', 'info');
                setTimeout(() => window.openChat(), 100);
            }
        }

        function viewShop() {
            // Use the global function from script.js
            if (window.viewShop && typeof window.viewShop === 'function') {
                window.viewShop();
            } else {
                // Fallback if script.js not loaded yet  
                showNotification('Đang tải thông tin shop...', 'info');
                setTimeout(() => window.viewShop(), 100);
            }
        }

        // Initialize product page when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for BookDatabase to be available
            const waitForData = () => {
                if (window.BookDatabase) {
                    console.log('BookDatabase loaded, initializing product page...');
                    initializeProductPage();
                } else {
                    console.log('BookDatabase not ready, retrying...');
                    setTimeout(waitForData, 50);
                }
            };
            
            setTimeout(waitForData, 10);
        });
    </script>
</body>
</html>